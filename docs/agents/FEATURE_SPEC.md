# Feature Spec for AI Agent (Phase-by-Phase)

本ドキュメントは AI エージェント向けに、段階的に実装を進めるための仕様メモです。

---

## セルの背景色取得機能追加

- セルの背景色情報も構造化対象にしてガントチャートのようなシートも守備範囲にする
- `SheetData`に`colors_map: Dict[str, List[Tuple[int,int]]]`を新たに追加して、色ごとにセルのrow,columnインデックスを集計する。
- `include_colors_map`オプションを追加
- デフォルトでは`verbose`モードでのみ有効。あとはオプションにする。
- デフォルト背景色はデフォルトでは取得しない。オプションにて白背景も取得対象にする
- パフォーマンスを落とさず機能を追加するのに既存の実装を再確認して検討する必要がある。

## リファクタリング案

- リソース取得の冗長性
  - 事象: 印刷範囲取得が openpyxl→COM のようにロジックがファイル内に分散。似たパターンが他にもある。
  - 対策案: 抽出パイプラインをステップ化し、各ステップ（cells, tables, shapes, charts, print_areas）の実装をモジュール単位で揃える。パイプライン定義を 1 か所にまとめるとモード追加や切替が容易になる。

## 今後のオプション（検討メモ）

- セル背景色取得モード
- 表検出スコアリングの閾値を CLI/環境変数で調整可能にする。
- 出力モード（light/standard/verbose）に応じてテーブル候補数を制限するオプション。
- RAG 連携用に JSON スキーマのサマリ／サンプル生成コマンドを追加。

---

## 実装方針

- 各ステップ完了ごとにテスト追加または既存フィクスチャで手動確認。
- 短い定数・関数分割でスコアリングの調整をしやすくする。
- 外部公開前なので、破壊的変更は適宜コメント・メモに残す。
