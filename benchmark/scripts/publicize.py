from __future__ import annotations

import shutil
from pathlib import Path


def _copy_file(src: Path, dest: Path) -> None:
    dest.parent.mkdir(parents=True, exist_ok=True)
    shutil.copy2(src, dest)


def _copy_glob(src_dir: Path, pattern: str, dest_dir: Path) -> None:
    for path in src_dir.glob(pattern):
        if path.is_file():
            _copy_file(path, dest_dir / path.name)


def main() -> int:
    root = Path(__file__).resolve().parents[1]
    public_dir = root / "public"

    report_src = root / "REPORT.md"
    if report_src.exists():
        _copy_file(report_src, public_dir / "REPORT.md")

    plots_dir = root / "outputs" / "plots"
    if plots_dir.exists():
        _copy_glob(plots_dir, "*.png", public_dir / "plots")

    results_report = root / "outputs" / "results" / "report.md"
    if results_report.exists():
        _copy_file(results_report, public_dir / "reports" / "results_report.md")

    rub_results_dir = root / "outputs" / "rub" / "results"
    if rub_results_dir.exists():
        for name in [
            "report.md",
            "report_gpt4o.md",
            "report_gpt41.md",
            "compare_gpt4o_gpt41.md",
        ]:
            src = rub_results_dir / name
            if src.exists():
                dest_name = name.replace("report", "rub_report", 1)
                _copy_file(src, public_dir / "reports" / dest_name)

    index_path = public_dir / "INDEX.md"
    lines = [
        "# Public Bundle",
        "",
        "This directory contains the public-ready benchmark artifacts.",
        "",
        "## Contents",
        "- REPORT.md",
        "- reports/",
        "- plots/",
        "",
        "Generated by scripts/publicize.py.",
        "",
    ]
    index_path.write_text("\n".join(lines), encoding="utf-8")

    return 0


if __name__ == "__main__":
    raise SystemExit(main())
